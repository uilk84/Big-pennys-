<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner v8 (Finnhub Live)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#0b1220;
  color:#e5f0ff;
}
header{
  text-align:center;
  padding:20px;
  font-size:26px;
  font-weight:bold;
}
.controls{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}
input,button{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-size:16px;
}
button{
  background:#3b82f6;
  color:white;
}
.status{
  text-align:center;
  margin:10px;
  color:#7dd3fc;
}
.card{
  background:#111a2e;
  border-radius:14px;
  padding:14px;
  margin:12px;
  box-shadow:0 0 10px rgba(0,0,0,.4);
}
.hot{border-left:5px solid #22c55e;}
.warm{border-left:5px solid #facc15;}
.watch{border-left:5px solid #38bdf8;}
.error{
  text-align:center;
  margin-top:30px;
  color:#f87171;
}
.center{
  text-align:center;
  margin-top:30px;
  color:#9fb7c6;
}
.leader{
  text-align:center;
  margin:8px;
  font-weight:bold;
  color:#22c55e;
}
a{color:#60a5fa;text-decoration:none;}
</style>
</head>
<body>

<header>üìà Penny Scanner v8 (Finnhub Live Only)</header>

<div class="controls">
  <input id="minVol" type="number" value="100000">
  <button onclick="runScan()">Scan Now</button>
</div>

<div class="status" id="status">Waiting for scan‚Ä¶</div>
<div class="leader" id="leader"></div>
<div id="results"></div>

<script>
// üîë PASTE YOUR FINNHUB KEY HERE
const API_KEY = "d1pdjtpr01qu436e4d50d1pdjtpr01qu436e4d5g";

function getSession(){
  const now = new Date();
  const et = new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const h = et.getHours();
  const m = et.getMinutes();
  const t = h*60 + m;

  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "OPEN";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

// Finnhub movers via symbols + quote
async function fetchSymbols(){
  const res = await fetch(`https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${API_KEY}`);
  if(!res.ok) throw new Error("Symbol list failed");
  return await res.json();
}

async function fetchQuote(sym){
  const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`);
  if(!res.ok) throw new Error("Quote failed");
  return await res.json();
}

function statusFromVolume(v){
  if(v>1000000) return "HOT";
  if(v>300000) return "WARM";
  return "WATCH";
}

function classFromStatus(s){
  if(s==="HOT") return "hot";
  if(s==="WARM") return "warm";
  return "watch";
}

async function runScan(){
  const session = getSession();
  const minVol = Number(document.getElementById("minVol").value);
  const results = document.getElementById("results");
  const leaderDiv = document.getElementById("leader");
  results.innerHTML="";
  leaderDiv.innerText="";

  document.getElementById("status").innerText = `Session: ${session} | Finnhub Live`;

  if(session==="CLOSED"){
    results.innerHTML = `<div class="center">Market is closed</div>`;
    return;
  }

  try{
    const symbols = await fetchSymbols();
    const slice = symbols.slice(0,30);

    let stocks = [];

    for(let s of slice){
      const q = await fetchQuote(s.symbol);
      if(q.v && q.c){
        stocks.push({
          symbol: s.symbol,
          price: q.c,
          volume: q.v
        });
      }
    }

    const filtered = stocks.filter(s => s.volume >= minVol);

    if(filtered.length===0){
      results.innerHTML = `<div class="center">No stocks found</div>`;
      return;
    }

    filtered.sort((a,b)=>b.volume - a.volume);

    leaderDiv.innerText = `üî• Leader: ${filtered[0].symbol}`;

    filtered.forEach(stock=>{
      const status = statusFromVolume(stock.volume);
      const div = document.createElement("div");
      div.className = `card ${classFromStatus(status)}`;
      div.innerHTML = `
        <strong>${stock.symbol} $${stock.price.toFixed(2)}</strong><br>
        Vol: ${stock.volume.toLocaleString()}<br>
        Status: ${status}<br>
        <a href="https://www.tradingview.com/chart/?symbol=${stock.symbol}" target="_blank">üìä Chart</a>
      `;
      results.appendChild(div);
    });

  }catch(err){
    results.innerHTML = `<div class="error">‚ö†Ô∏è Live feed unavailable<br>${err.message}</div>`;
    document.getElementById("status").innerText = `Session: ${session} | API ERROR`;
  }
}

// auto refresh every 30s
runScan();
setInterval(runScan,30000);
</script>

</body>
</html>
