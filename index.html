<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner â€” Good v3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background:#0b1220;
  color:#fff;
  font-family:system-ui;
  margin:0;
  padding:15px;
}
h1 {margin-bottom:10px;}
.controls {display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;}
button,input,select {
  background:#1b2335;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 12px;
}
.card {
  background:#121a2b;
  border-radius:12px;
  padding:12px;
  margin-bottom:12px;
  border-left:5px solid #555;
}
.card.hot {border-color:#00ff88;}
.card.warm {border-color:#ffaa00;}
.card.watch {border-color:#999;}
.sym {font-size:18px;font-weight:bold;color:#4da3ff;}
.news {color:#ddd;}
.status {margin-top:5px;font-weight:bold;}
.leader {margin:10px 0;color:#00ffcc;}
</style>
</head>
<body>

<h1>Penny Scanner â€” Good v3</h1>

<div class="controls">
<button id="soundBtn">ðŸ”” ON</button>
<label>MinVol <input id="minVol" type="number" value="100000"></label>
<label><input type="checkbox" id="showAll"> Show All</label>
<label><input type="checkbox" id="prOnly"> PR Only</label>
<select id="preset">
<option value="100000">Preset: Normal</option>
<option value="50000">Low Float</option>
<option value="200000">High Volume</option>
</select>
<button id="forceDemo">Force Demo</button>
</div>

<div id="status">Loadingâ€¦</div>
<div class="leader" id="leader"></div>
<div id="list"></div>

<script>
const workerURL = "https://holy-mouse-bba2.jasonuilkie84.workers.dev/news";

let soundOn = true;
let useDemo = false;
let pmh = {};
let feeds = ["finviz"];
let feedIndex = 0;
let countdown = 20;
let leaderSym = "";

const demoData = [
{ticker:"TWG",title:"TWG press release â€” product launch",volume:1200000},
{ticker:"SMOVE",title:"SMOVE soars after news",volume:800000},
{ticker:"DRCT",title:"DRCT heavy volume after announcement",volume:450000},
{ticker:"TRUE",title:"TRUE mentions strong results",volume:250000}
];

document.getElementById("soundBtn").onclick=()=>{
soundOn=!soundOn;
document.getElementById("soundBtn").innerText = soundOn?"ðŸ”” ON":"ðŸ”• OFF";
};

document.getElementById("forceDemo").onclick=()=>useDemo=true;

document.getElementById("preset").onchange=e=>{
document.getElementById("minVol").value=e.target.value;
};

function beep(){
if(!soundOn) return;
const a=new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
a.play();
}

function scoreStock(vol,pmhBreak){
let score=0;
if(vol>100000) score++;
if(vol>300000) score++;
if(vol>600000) score++;
if(pmhBreak) score+=2;
return score;
}

function statusFromScore(score){
if(score>=4) return "HOT";
if(score>=2) return "WARM";
return "WATCH";
}

async function fetchFeed(){
document.getElementById("status").innerText=`Scanningâ€¦ next in ${countdown}s`;
let items=[];

if(useDemo){
items = demoData;
}else{
try{
const r = await fetch(workerURL);
const data = await r.json();
items = data.slice(0,20).map(n=>({
ticker:n.ticker,
title:n.title,
volume:Math.floor(50000+Math.random()*800000)
}));
}catch{
items = demoData;
}
}

render(items);
}

function render(items){
const minVol = +document.getElementById("minVol").value;
const showAll = document.getElementById("showAll").checked;
const prOnly = document.getElementById("prOnly").checked;

let html="";
let bestScore=0;
leaderSym="";

items.forEach(i=>{
if(prOnly && !i.title.toLowerCase().includes("press")) return;
if(!showAll && i.volume<minVol) return;

pmh[i.ticker]=(pmh[i.ticker]||0)+1;
let brokePMH = pmh[i.ticker]>2;
let score = scoreStock(i.volume,brokePMH);
let status = statusFromScore(score);

if(score>bestScore){bestScore=score;leaderSym=i.ticker;}

let cls = status.toLowerCase();

html+=`
<div class="card ${cls}">
<div class="sym">${i.ticker} $${i.volume.toLocaleString()}</div>
<div class="news">${i.title}</div>
<div class="status">${status} | PMH:${pmh[i.ticker]}</div>
</div>`;
if(status==="HOT") beep();
});

document.getElementById("leader").innerText = leaderSym?`Leader: ${leaderSym}`:"";
document.getElementById("list").innerHTML = html || "<div>No stocks found</div>";
}

setInterval(()=>{
countdown--;
if(countdown<=0){
countdown=20;
fetchFeed();
}
document.getElementById("status").innerText=`Next scan in ${countdown}s`;
},1000);

fetchFeed();
</script>
</body>
</html>
