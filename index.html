<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner PRO v21</title>
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0b1220;
  color:white;
  text-align:center;
}
h1{margin-top:20px}
input,button{
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
  font-size:16px;
}
button{background:#3b82f6;color:white}
.card{
  background:#111a2e;
  margin:12px;
  padding:12px;
  border-radius:12px;
  text-align:left;
}
.status{margin:10px;font-weight:bold}
</style>
</head>
<body>

<h1>ðŸ“ˆ Penny Scanner PRO v21</h1>

<input id="apikey" placeholder="Enter Finnhub API Key">
<button onclick="saveKey()">Save Key</button>
<br>

<input id="minvol" value="100000">
<button onclick="scan()">Scan Now</button>

<div id="session" class="status"></div>
<div id="results"></div>

<script>
let API_KEY="";

function saveKey(){
  API_KEY=document.getElementById("apikey").value.trim();
  localStorage.setItem("finnhub_key",API_KEY);
  alert("API Key Saved");
}

API_KEY=localStorage.getItem("finnhub_key")||"";
document.getElementById("apikey").value=API_KEY;

function getSession(){
  const now=new Date();
  const et=new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const t=et.getHours()*60+et.getMinutes();

  if(t>=570 && t<960) return "OPEN";        // 9:30â€“16:00
  if(t>=240 && t<570) return "PRE-MARKET";  // 4:00â€“9:30
  if(t>=960 && t<1200) return "AFTER-HOURS";// 16:00â€“20:00
  return "CLOSED";
}

async function scan(){
  if(!API_KEY){
    alert("Enter API key first");
    return;
  }

  const session=getSession();
  document.getElementById("session").innerText=`Session: ${session}`;
  document.getElementById("results").innerHTML="Loading...";

  if(session==="OPEN"){
    scanStocks();
  }else{
    scanNews();
  }
}

async function scanNews(){
  const url=`https://finnhub.io/api/v1/news?category=general&token=${API_KEY}`;
  const r=await fetch(url);
  const data=await r.json();

  let html="";
  data.slice(0,10).forEach(n=>{
    html+=`
      <div class="card">
        <b>NEWS</b><br>
        ${n.headline}<br>
        <small>${n.source}</small><br>
        <a href="${n.url}" target="_blank" style="color:#60a5fa">Read</a>
      </div>`;
  });

  document.getElementById("results").innerHTML=html;
}

async function scanStocks(){
  const minVol=parseInt(document.getElementById("minvol").value);
  const symbols=["AAPL","TSLA","AMD","NVDA","PLTR","SOFI","LCID","F","NIO","RIVN"];
  let results=[];

  for(const s of symbols){
    const url=`https://finnhub.io/api/v1/quote?symbol=${s}&token=${API_KEY}`;
    const r=await fetch(url);
    const q=await r.json();

    if(q.c && q.v>=minVol && q.c<10){
      results.push({s,price:q.c,vol:q.v});
    }
  }

  if(results.length===0){
    document.getElementById("results").innerHTML="No penny stocks found.";
    return;
  }

  let html="";
  results.forEach(x=>{
    html+=`
      <div class="card">
        <b>${x.s} $${x.price}</b><br>
        Vol: ${x.vol}
      </div>`;
  });

  document.getElementById("results").innerHTML=html;
}
</script>

</body>
</html>
