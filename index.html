<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner v4</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#0b1220;color:white;font-family:system-ui;margin:0;padding:15px}
h1{margin-bottom:10px}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
button,input,select{background:#1b2335;color:white;border:none;border-radius:10px;padding:8px 12px}
.card{background:#121a2b;border-radius:12px;padding:12px;margin-bottom:12px;border-left:5px solid #444}
.hot{border-color:#00ff88}
.warm{border-color:#ffaa00}
.watch{border-color:#888}
.sym{font-size:18px;font-weight:bold;color:#4da3ff}
.news{color:#eee}
.status{margin-top:5px;font-weight:bold}
.leader{color:#00ffcc;margin:10px 0}
a{color:#8ab4ff;text-decoration:none}
</style>
</head>
<body>

<h1>Penny Scanner v4</h1>

<div class="controls">
<button id="soundBtn">ðŸ”” ON</button>
<select id="session">
<option value="RTH">RTH</option>
<option value="PM">PM</option>
<option value="AH">AH</option>
</select>
<label>MinVol <input id="minVol" type="number" value="100000"></label>
<label><input type="checkbox" id="showAll"> Show All</label>
<label><input type="checkbox" id="prOnly"> PR Only</label>
<button id="forceDemo">Force Demo</button>
</div>

<div id="status">Loadingâ€¦</div>
<div class="leader" id="leader"></div>
<div id="list"></div>

<script>
const workerURL="https://holy-mouse-bba2.jasonuilkie84.workers.dev/news";
const feeds=["finviz","finviz2","finviz3"];
let feedIndex=0;
let countdown=20;
let soundOn=true;
let useDemo=false;
let pmh={};
let today=new Date().toDateString();
let leader="";

const demoData=[
{ticker:"TWG",title:"TWG press release â€” product launch",volume:1200000},
{ticker:"SMOVE",title:"SMOVE soars after news",volume:800000},
{ticker:"DRCT",title:"DRCT heavy volume after announcement",volume:450000},
{ticker:"TRUE",title:"TRUE mentions strong results",volume:250000}
];

document.getElementById("soundBtn").onclick=()=>{
soundOn=!soundOn;
document.getElementById("soundBtn").innerText=soundOn?"ðŸ”” ON":"ðŸ”• OFF";
};

document.getElementById("forceDemo").onclick=()=>useDemo=true;

function beep(){
if(!soundOn) return;
new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
}

function resetDaily(){
const now=new Date().toDateString();
if(now!==today){
pmh={};
today=now;
}
}

function scoreStock(vol,pmhBreak){
let s=0;
if(vol>100000)s++;
if(vol>300000)s++;
if(vol>600000)s++;
if(pmhBreak)s+=2;
return s;
}

function statusFromScore(s){
if(s>=4)return"HOT";
if(s>=2)return"WARM";
return"WATCH";
}

async function fetchFeed(){
resetDaily();
document.getElementById("status").innerText=`Feed: ${feeds[feedIndex]} | Next scan in ${countdown}s`;

let items=[];
if(useDemo){
items=demoData;
}else{
try{
const r=await fetch(workerURL);
const data=await r.json();
items=data.slice(0,20).map(n=>({
ticker:n.ticker,
title:n.title,
volume:Math.floor(50000+Math.random()*900000)
}));
}catch{
items=demoData;
}
}

render(items);
feedIndex=(feedIndex+1)%feeds.length;
}

function render(items){
const minVol=+document.getElementById("minVol").value;
const showAll=document.getElementById("showAll").checked;
const prOnly=document.getElementById("prOnly").checked;

let html="";
let best=0;
leader="";

items.forEach(i=>{
if(prOnly && !i.title.toLowerCase().includes("press")) return;
if(!showAll && i.volume<minVol) return;

pmh[i.ticker]=(pmh[i.ticker]||0)+1;
let broke=pmh[i.ticker]>2;
let score=scoreStock(i.volume,broke);
let status=statusFromScore(score);

if(score>best){best=score;leader=i.ticker;}

let cls=status.toLowerCase();
let chart=`https://www.tradingview.com/chart/?symbol=${i.ticker}`;

html+=`
<div class="card ${cls}">
<div class="sym">${i.ticker} $${i.volume.toLocaleString()}</div>
<div class="news">${i.title}</div>
<div class="status">${status} | PMH:${pmh[i.ticker]}</div>
<a href="${chart}" target="_blank">ðŸ“ˆ Chart</a>
</div>`;

if(status==="HOT")beep();
});

document.getElementById("leader").innerText=leader?`Leader: ${leader}`:"";
document.getElementById("list").innerHTML=html||"<div>No stocks found</div>";
}

setInterval(()=>{
countdown--;
if(countdown<=0){
countdown=20;
fetchFeed();
}
document.getElementById("status").innerText=`Next scan in ${countdown}s`;
},1000);

fetchFeed();
</script>
</body>
</html>
