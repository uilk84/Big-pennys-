<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0b1220;
  color:white;
  text-align:center;
}
h1{margin-top:20px}
input,button{
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
button{background:#3b82f6;color:white;margin-left:5px}
.card{
  background:#111a2f;
  margin:12px;
  padding:15px;
  border-radius:12px;
  text-align:left;
}
.hot{border-left:6px solid #00ff9c}
.warm{border-left:6px solid orange}
.watch{border-left:6px solid #60a5fa}
</style>
</head>
<body>

<h1>ðŸ“ˆ Penny Scanner PRO</h1>

<input id="apikey" placeholder="d5ubd49r01quhg55j9ogd5ubd49r01quhg55j9p0">
<button onclick="saveKey()">Save Key</button>

<br><br>

<input id="minVol" value="100000" type="number">
<button onclick="scan()">Scan Now</button>

<p id="session"></p>
<p id="status"></p>

<div id="results"></div>

<script>
let API_KEY = localStorage.getItem("finnhub_key") || "PASTE_API_KEY_HERE";
document.getElementById("apikey").value = API_KEY;

function saveKey(){
  API_KEY = document.getElementById("apikey").value.trim();
  localStorage.setItem("finnhub_key", API_KEY);
  alert("Key saved");
}

function getSession(){
  const now = new Date();
  const et = new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const t = et.getHours()*60 + et.getMinutes();
  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "OPEN";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

async function scan(){
  const minVol = parseInt(document.getElementById("minVol").value);
  const session = getSession();
  document.getElementById("session").innerText = "Session: "+session;
  document.getElementById("status").innerText = "Scanning...";
  document.getElementById("results").innerHTML = "";

  if(!API_KEY){
    document.getElementById("status").innerText="No API key";
    return;
  }

  try{
    const newsRes = await fetch(`https://finnhub.io/api/v1/news?category=general&token=${API_KEY}`);
    const news = await newsRes.json();

    let shown=0;

    for(const n of news.slice(0,10)){
      const symbol = n.related.split(",")[0];
      if(!symbol) continue;

      const q = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEY}`);
      const quote = await q.json();

      const to = Math.floor(Date.now()/1000);
      const from = to - 3600*6;
      const c = await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=1&from=${from}&to=${to}&token=${API_KEY}`);
      const candles = await c.json();

      let volume = 0;
      if(candles.s==="ok" && candles.v.length){
        volume = candles.v[candles.v.length-1];
      }

      if(quote.c<=10 && volume>=minVol){
        shown++;
        let status="WATCH",cls="watch";
        if(volume>500000) {status="WARM";cls="warm";}
        if(volume>1000000){status="HOT";cls="hot";}

        document.getElementById("results").innerHTML += `
        <div class="card ${cls}">
          <b>${symbol} $${quote.c.toFixed(2)}</b><br>
          Vol: ${volume.toLocaleString()}<br>
          ${n.headline}<br>
          Status: ${status}<br>
          <a href="${n.url}" target="_blank">Article</a>
        </div>`;
      }
    }

    if(shown===0){
      document.getElementById("status").innerText="No penny stocks found";
    } else {
      document.getElementById("status").innerText="Scan complete";
    }

  }catch(e){
    document.getElementById("status").innerText="API Error";
    console.log(e);
  }
}
</script>

</body>
</html>
