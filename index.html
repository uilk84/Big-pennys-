<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner v7</title>
<style>
body {
  margin:0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background:#0b1220;
  color:white;
}
header {
  padding:20px;
  text-align:center;
}
input,button {
  padding:10px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
button {
  background:#3b82f6;
  color:white;
}
#status { margin-top:10px; color:#38bdf8; }
.leader { color:#22c55e; font-weight:bold; margin-top:10px;}
.card {
  background:#111827;
  margin:15px;
  padding:15px;
  border-radius:16px;
  box-shadow:0 0 10px rgba(0,0,0,.5);
}
.hot { border-left:6px solid #22c55e;}
.warm { border-left:6px solid #facc15;}
.watch { border-left:6px solid #38bdf8;}
a { color:#60a5fa; text-decoration:none;}
</style>
</head>

<body>

<header>
<h1>ðŸ“ˆ Penny Scanner v7</h1>
<input id="minVol" type="number" value="100000">
<button onclick="scan()">Scan Now</button>
<div id="status"></div>
<div id="leader" class="leader"></div>
</header>

<div id="results"></div>

<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
let lastLeader = "";

function marketSession(){
  const now = new Date();
  const est = now.getUTCHours() - 5;
  if(est >= 4 && est < 9.5) return "PRE-MARKET";
  if(est >= 9.5 && est < 16) return "OPEN";
  if(est >= 16 && est < 20) return "AFTER-HOURS";
  return "CLOSED";
}

function score(vol){
  if(vol > 800000) return "HOT";
  if(vol > 300000) return "WARM";
  return "WATCH";
}

async function scan(){
  const minVol = parseInt(document.getElementById("minVol").value);
  const session = marketSession();
  document.getElementById("status").innerText = `Session: ${session} | Fetching Yahoo Top Gainers...`;

  const url = "https://query1.finance.yahoo.com/v7/finance/screener/predefined/saved?count=20&scrIds=day_gainers";

  try{
    const res = await fetch(url);
    const data = await res.json();
    const stocks = data.finance.result[0].quotes;
    render(stocks, minVol);
    document.getElementById("status").innerText = `Session: ${session} | Live Yahoo Finance`;
  } catch(err){
    console.log("Demo fallback", err);
    demo(minVol);
    document.getElementById("status").innerText = `Session: ${session} | Demo fallback`;
  }
}

function render(stocks, minVol){
  const container = document.getElementById("results");
  container.innerHTML = "";
  let leader = null;

  stocks.forEach(s=>{
    const vol = s.regularMarketVolume || 0;
    if(vol < minVol) return;

    if(!leader || vol > leader.regularMarketVolume) leader = s;

    const status = score(vol);
    const cls = status.toLowerCase();

    const card = document.createElement("div");
    card.className = `card ${cls}`;
    card.innerHTML = `
      <b>${s.symbol} $${s.regularMarketPrice}</b><br>
      Vol: ${vol.toLocaleString()}<br>
      Status: ${status}<br>
      <a target="_blank" href="https://finance.yahoo.com/quote/${s.symbol}">ðŸ“Š Chart</a>
    `;
    container.appendChild(card);

    if(status === "HOT" && s.symbol !== lastLeader){
      document.getElementById("beep").play();
    }
  });

  if(leader){
    document.getElementById("leader").innerText = `ðŸ”¥ Leader: ${leader.symbol}`;
    lastLeader = leader.symbol;
  }

  if(container.innerHTML === ""){
    container.innerHTML = "<p style='text-align:center'>No stocks found</p>";
  }
}

function demo(minVol){
  const demoStocks = [
    {symbol:"SMOVE", regularMarketPrice:3.42, regularMarketVolume:800000},
    {symbol:"TWG", regularMarketPrice:5.11, regularMarketVolume:1200000},
    {symbol:"DRCT", regularMarketPrice:2.95, regularMarketVolume:450000},
    {symbol:"TRUE", regularMarketPrice:1.88, regularMarketVolume:250000}
  ];
  render(demoStocks, minVol);
}

scan();
setInterval(scan,30000);
</script>

</body>
</html>
