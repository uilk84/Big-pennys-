<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PennyS Scanner â€“ PMH + News</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:-apple-system;background:#02040a;color:#e5e7eb}
.container{padding:16px}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
button,input{background:#1f2937;color:#fff;border:none;border-radius:8px;padding:6px 10px}
input{width:70px}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:6px;border-bottom:1px solid #1f2937}
th{opacity:.7;text-align:left}
.aplus{background:rgba(34,197,94,.25)}
.watch{background:rgba(234,179,8,.18)}
.notrade{opacity:.45}
.lowfloat{color:#22c55e;font-weight:700}
.ultrafloat{color:#38bdf8;font-weight:700}
.good{color:#22c55e;font-weight:700}
.bad{color:#ef4444;font-weight:700}
.small{opacity:.6;font-size:12px}
a{color:#93c5fd;text-decoration:none}
.news{font-size:11px;opacity:.85}
</style>
</head>

<body>
<div class="container">
  <h2>PennyS Scanner (PMH + News)</h2>

  <div class="controls">
    <button id="soundBtn">ðŸ”” ON</button>
    <label><input type="checkbox" id="pre"> PM</label>
    <label><input type="checkbox" id="post"> AH</label>

    <button onclick="preset('lotto')">ðŸŽ°</button>
    <button onclick="preset('scalp')">âš¡</button>
    <button onclick="preset('momentum')">ðŸš€</button>

    <label>Min <input id="minPrice" type="number" value="0.10"></label>
    <label>Max <input id="maxPrice" type="number" value="10"></label>
    <label>Risk <input id="riskPerTrade" type="number" value="100"></label>
  </div>

  <div class="small">Session: <span id="session"></span></div>

  <table>
    <thead>
      <tr>
        <th>Sym</th>
        <th>Price</th>
        <th>PMH</th>
        <th>Float</th>
        <th>Vol</th>
        <th>News</th>
        <th>Stop</th>
        <th>R:R</th>
        <th>Sh</th>
        <th>Signal</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="10" class="small">Waitingâ€¦</td></tr>
    </tbody>
  </table>
</div>

<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const rows=document.getElementById("rows");
const beep=document.getElementById("beep");
const soundBtn=document.getElementById("soundBtn");
const sessionEl=document.getElementById("session");

let sound=true;
let pmh={}, lastPrice={}, lastVol={}, alerted={};

/* FLOAT MAP (extend anytime) */
const floatMap = {
  SMOVE:12000000,
  DRCT:18000000
};

soundBtn.onclick=()=>{sound=!sound;soundBtn.textContent=sound?"ðŸ”” ON":"ðŸ”• OFF"}

function preset(p){
  if(p==="lotto"){minPrice.value=.1;maxPrice.value=1}
  if(p==="scalp"){minPrice.value=.3;maxPrice.value=3}
  if(p==="momentum"){minPrice.value=1;maxPrice.value=10}
  scan()
}

function session(){
  const d=new Date(new Date().toLocaleString("en-US",{timeZone:"America/New_York"}))
  const h=d.getHours()+d.getMinutes()/60
  if(h>=4&&h<9.5) return "PM"
  if(h>=9.5&&h<16) return "RTH"
  if(h>=16&&h<=20) return "AH"
  return "CLOSED"
}

function allowed(){
  const s=session()
  if(s==="PM") return pre.checked
  if(s==="RTH") return true
  if(s==="AH") return post.checked
  return false
}

/* ===== NEWS LOOKUP ===== */
async function getNews(sym){
  try{
    const r=await fetch(
      `https://corsproxy.io/?https://query1.finance.yahoo.com/v1/finance/search?q=${sym}`
    );
    const j=await r.json();
    if(j.news && j.news.length){
      const n=j.news[0];
      return n.title;
    }
  }catch{}
  return null;
}

async function scan(){
  sessionEl.textContent=session()
  if(!allowed()){
    rows.innerHTML=`<tr><td colspan=10 class=small>Session blocked</td></tr>`;
    return;
  }

  const min=+minPrice.value,max=+maxPrice.value,riskMax=+riskPerTrade.value;

  try{
    const r=await fetch("https://corsproxy.io/?https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved?count=30&scrIds=day_gainers");
    const q=(await r.json()).finance.result[0].quotes;
    rows.innerHTML="";

    for(const t of q){
      const p=t.regularMarketPrice,v=t.regularMarketVolume||0,s=t.symbol;
      if(!s||!p||p<min||p>max) continue;

      const prevPrice=lastPrice[s]||p;
      const prevVol=lastVol[s]||v;
      lastPrice[s]=p; lastVol[s]=v;

      if(session()==="PM"){
        pmh[s]=Math.max(pmh[s]||0,p);
      }

      const hasPMH=pmh[s]>0;
      const brokePMH=hasPMH && p>pmh[s];
      const retestHold=brokePMH && prevPrice>=pmh[s]*0.99 && p>=pmh[s];
      const volAccel=v>prevVol*1.3;

      const fl=floatMap[s]||null;
      if(!fl || fl>30000000) continue; // FLOAT FILTER

      const news=await getNews(s);
      if(!news) continue; // NEWS FILTER

      const stop=hasPMH?pmh[s]*0.97:p*0.97;
      const risk=p-stop;
      if(risk<=0) continue;

      const sh=Math.floor(riskMax/risk);
      const rr=((risk*2)/risk).toFixed(1);

      let sig="WATCH",cls="watch";
      if(retestHold && volAccel && sh>=1){
        sig="A+ PMH + NEWS";
        cls="aplus";
      }

      rows.innerHTML+=`
        <tr class=${cls}>
          <td><a target=_blank href="https://www.tradingview.com/chart/?symbol=${s}">${s}</a></td>
          <td>$${p.toFixed(2)}</td>
          <td>${hasPMH?pmh[s].toFixed(2):"-"}</td>
          <td class="lowfloat">LOW</td>
          <td>${(v/1e6).toFixed(2)}M</td>
          <td class="news">${news}</td>
          <td>$${stop.toFixed(2)}</td>
          <td class=${rr>=2?"good":"bad"}>${rr}</td>
          <td>${sh}</td>
          <td>${sig}</td>
        </tr>`;

      if(sig==="A+ PMH + NEWS" && !alerted[s] && sound){
        beep.play();
        navigator.vibrate?.([200,100,200]);
        alerted[s]=1;
      }
    }

    if(!rows.children.length)
      rows.innerHTML=`<tr><td colspan=10 class=small>No A+ news setups</td></tr>`;

  }catch{
    rows.innerHTML=`<tr><td colspan=10 class=small>Feed error</td></tr>`;
  }
}

scan();
setInterval(scan,20000);
</script>
</body>
</html>
