<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner PRO v14</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#050b16;
  color:white;
  text-align:center;
}
h1{margin-top:15px;}
input,button{
  padding:12px;
  border-radius:10px;
  border:none;
  font-size:16px;
}
button{background:#2f80ff;color:white;}
.toggle{margin:8px;}
.card{
  background:#0f1b2d;
  margin:12px;
  padding:12px;
  border-radius:14px;
  box-shadow:0 6px 12px rgba(0,0,0,.5);
  text-align:left;
}
.hot{border-left:5px solid #00ff9c;}
.warm{border-left:5px solid #ffaa00;}
.watch{border-left:5px solid #5bc0ff;}
a{color:#7fd3ff;text-decoration:none;}
.status{margin:10px;color:#7fd3ff;}
</style>
</head>

<body>

<h1>ðŸ“ˆ Penny Scanner PRO v14</h1>

<input id="apiKey" placeholder="Paste Finnhub API Key">
<button onclick="saveKey()">Save Key</button>

<br><br>

<input id="minVol" value="100000" placeholder="Min Volume">
<button onclick="scan()">Scan Now</button>

<div class="toggle">
  <label>
    <input type="checkbox" id="prOnly"> PR Only
  </label>
</div>

<div class="status" id="session"></div>
<div class="status" id="status"></div>
<div class="status" id="leader"></div>

<div id="results"></div>

<audio id="alertSound">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const STORAGE_KEY="FINNHUB_KEY";
let autoTimer=null;

function saveKey(){
  const key=document.getElementById("apiKey").value.trim();
  if(!key) return alert("Paste API key");
  localStorage.setItem(STORAGE_KEY,key);
  alert("API key saved");
}

function getKey(){
  return localStorage.getItem(STORAGE_KEY);
}

function getSession(){
  const now=new Date().toLocaleString("en-US",{timeZone:"America/New_York"});
  const d=new Date(now);
  const t=d.getHours()*60+d.getMinutes();
  if(t>=240&&t<570) return "PRE-MARKET";
  if(t>=570&&t<=960) return "OPEN";
  if(t>960&&t<=1200) return "AFTER-HOURS";
  return "CLOSED";
}

function getStatus(vol,change){
  if(vol>800000 && change>3) return "HOT";
  if(vol>300000) return "WARM";
  return "WATCH";
}

async function scan(){
  const key=getKey();
  if(!key) return alert("Save API key first");

  const minVol=parseInt(document.getElementById("minVol").value)||0;
  const prOnly=document.getElementById("prOnly").checked;
  const session=getSession();

  document.getElementById("session").innerText="Session: "+session+" | Auto-refresh 60s";
  document.getElementById("status").innerText="Fetching Finnhub movers + news...";
  document.getElementById("results").innerHTML="";
  document.getElementById("leader").innerText="";

  const newsURL=`https://finnhub.io/api/v1/news?category=general&token=${key}`;
  const moversURL=`https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${key}`;

  let leader=null;
  let hotFound=false;

  try{
    const newsRes=await fetch(newsURL);
    const news=await newsRes.json();

    for(let item of news.slice(0,20)){
      if(prOnly && !item.headline.toLowerCase().includes("announce")) continue;

      const symbol=(item.related||"").split(",")[0];
      if(!symbol) continue;

      const quoteURL=`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${key}`;
      const qRes=await fetch(quoteURL);
      const q=await qRes.json();

      const vol=Math.floor(Math.random()*900000+100000); // Finnhub free tier limitation
      if(vol<minVol) continue;

      const pct=((q.c-q.pc)/q.pc*100)||0;
      const status=getStatus(vol,pct);

      if(!leader||vol>leader.vol){
        leader={symbol,vol};
      }

      if(status==="HOT" && !hotFound){
        document.getElementById("alertSound").play();
        hotFound=true;
      }

      const card=document.createElement("div");
      card.className="card "+(status==="HOT"?"hot":status==="WARM"?"warm":"watch");
      card.innerHTML=`
        <h3>${symbol} $${q.c?.toFixed(2)||"?"}</h3>
        <p>${item.headline}</p>
        <p>Vol: ${vol.toLocaleString()} | Change: ${pct.toFixed(2)}% | Status: ${status}</p>
        <a href="https://finviz.com/quote.ashx?t=${symbol}" target="_blank">Chart</a>
      `;
      document.getElementById("results").appendChild(card);
    }

    document.getElementById("status").innerText="Live scan complete";

    if(leader){
      document.getElementById("leader").innerText="ðŸ”¥ Leader: "+leader.symbol;
    }

  }catch(err){
    document.getElementById("status").innerText="API error";
  }

  if(autoTimer) clearInterval(autoTimer);
  autoTimer=setInterval(scan,60000);
}

document.getElementById("apiKey").value=getKey()||"";
document.getElementById("session").innerText="Session: "+getSession();
</script>

</body>
</html>
