<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner vA</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#0b1220;
  color:white;
}
.container {
  padding:20px;
  max-width:700px;
  margin:auto;
}
button,input {
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
button {
  background:#3b82f6;
  color:white;
}
.card {
  background:#111827;
  border-radius:12px;
  padding:12px;
  margin:12px 0;
  border-left:6px solid #22c55e;
}
.warm {border-left-color:#facc15;}
.watch {border-left-color:#38bdf8;}
h1 {text-align:center;}
.small {color:#94a3b8;font-size:14px;}
</style>
</head>

<body>
<div class="container">
<h1>ðŸ“ˆ Penny Scanner vA</h1>

<input id="vol" type="number" value="100000" placeholder="Min Volume">
<button onclick="scan()">Scan Now</button>

<p id="session"></p>
<p id="status"></p>
<div id="results"></div>
</div>

<script>
const API_KEY = "d5ubd49r01quhg55j9ogd5ubd49r01quhg55j9p0";

function getSession(){
  const now = new Date();
  const et = new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const t = et.getHours()*60 + et.getMinutes();

  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "RTH";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

async function scan(){
  const minVol = parseInt(document.getElementById("vol").value);
  const session = getSession();
  document.getElementById("session").innerText = "Session: " + session;
  document.getElementById("status").innerText = "Fetching symbols...";
  document.getElementById("results").innerHTML="";

  try{
    const symbolsRes = await fetch(`https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${API_KEY}`);
    const symbols = await symbolsRes.json();

    const picks = symbols.slice(0,40); // limit API usage
    let results = [];

    for(let s of picks){
      const qRes = await fetch(`https://finnhub.io/api/v1/quote?symbol=${s.symbol}&token=${API_KEY}`);
      const q = await qRes.json();

      if(!q.c || q.v < minVol || q.c > 10) continue;

      let newsTitle="No news";

      try{
        const nRes = await fetch(`https://finnhub.io/api/v1/company-news?symbol=${s.symbol}&from=2026-01-01&to=2026-12-31&token=${API_KEY}`);
        const news = await nRes.json();
        if(news.length>0) newsTitle = news[0].headline;
      }catch{}

      const status = q.v > minVol*5 ? "HOT" : q.v > minVol*2 ? "WARM" : "WATCH";

      results.push({
        symbol:s.symbol,
        price:q.c,
        vol:q.v,
        news:newsTitle,
        status
      });
    }

    render(results);

  }catch(e){
    document.getElementById("status").innerText="API Error";
  }
}

function render(list){
  document.getElementById("status").innerText = `Found ${list.length} stocks`;
  const box = document.getElementById("results");

  if(list.length===0){
    box.innerHTML="<p>No penny stocks found</p>";
    return;
  }

  list.sort((a,b)=>b.vol-a.vol);

  list.forEach(s=>{
    const div = document.createElement("div");
    div.className="card " + (s.status==="HOT"?"":"warm");
    div.innerHTML = `
      <b>${s.symbol} $${s.price.toFixed(2)}</b><br>
      Vol: ${s.vol.toLocaleString()}<br>
      ${s.news}<br>
      <b>Status: ${s.status}</b><br>
      <a href="https://finance.yahoo.com/quote/${s.symbol}" target="_blank">ðŸ“Š Chart</a>
    `;
    box.appendChild(div);
  });
}
</script>
</body>
</html>
