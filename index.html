<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner PRO v24</title>
<style>
body {
  font-family: Arial, sans-serif;
  background:#020617;
  color:white;
  text-align:center;
}
input,button {
  padding:10px;
  border-radius:8px;
  border:none;
  margin:5px;
}
button {background:#3b82f6;color:white;font-weight:bold;}
.card {
  background:#0f172a;
  margin:10px;
  padding:12px;
  border-radius:12px;
  text-align:left;
}
.hot {border-left:5px solid #22c55e;}
.warm {border-left:5px solid orange;}
.watch {border-left:5px solid #38bdf8;}
small {opacity:.7;}
</style>
</head>
<body>

<h1>ðŸ“ˆ Penny Scanner PRO v24</h1>

<input id="apiKey" placeholder="Finnhub API Key"/>
<button onclick="saveKey()">Save Key</button><br>

<input id="minVol" type="number" value="10000"/>
<button onclick="scan()">Scan Now</button>

<p id="session"></p>
<div id="results"></div>

<script>
let API_KEY = localStorage.getItem("FINNHUB_KEY") || "";
document.getElementById("apiKey").value = API_KEY;

function saveKey(){
  API_KEY = document.getElementById("apiKey").value.trim();
  localStorage.setItem("FINNHUB_KEY",API_KEY);
  alert("API key saved");
}

function getSession(){
  const now = new Date().toLocaleString("en-US",{timeZone:"America/New_York"});
  const d = new Date(now);
  const t = d.getHours()*60 + d.getMinutes();
  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "OPEN";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

async function scan(){
  const session = getSession();
  document.getElementById("session").innerText = "Session: " + session;
  document.getElementById("results").innerHTML = "Scanning market...";

  if(!API_KEY){
    alert("Enter API key");
    return;
  }

  if(session==="CLOSED"){
    fetchNews();
  } else {
    fetchMarketStocks();
  }
}

async function fetchMarketStocks(){
  const minVol = parseInt(document.getElementById("minVol").value);
  const symRes = await fetch(`https://finnhub.io/api/v1/stock/symbol?exchange=US&token=${API_KEY}`);
  const symbols = await symRes.json();

  let html="";
  let found=0;

  // scan first 200 symbols to avoid rate limits
  for(let i=0;i<symbols.length && i<200;i++){
    const sym = symbols[i].symbol;
    try{
      const q = await fetch(`https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`);
      const data = await q.json();
      if(!data.c) continue;

      if(data.c <= 10 && data.v >= minVol){
        let status="WATCH";
        if(data.dp > 5) status="HOT";
        else if(data.dp > 2) status="WARM";

        html+=`
        <div class="card ${status.toLowerCase()}">
          <b>${sym} $${data.c.toFixed(2)}</b><br>
          Vol: ${data.v}<br>
          Change: ${data.dp}%<br>
          Status: ${status}<br>
          <a href="https://www.tradingview.com/chart/?symbol=${sym}" target="_blank">ðŸ“Š Chart</a>
        </div>`;
        found++;
      }
    } catch(e){}
  }

  if(found===0){
    document.getElementById("results").innerHTML="No penny stocks found in first 200 symbols";
  } else {
    document.getElementById("results").innerHTML=html;
  }
}

async function fetchNews(){
  const res = await fetch(`https://finnhub.io/api/v1/news?category=general&token=${API_KEY}`);
  const news = await res.json();
  let html="";
  news.slice(0,10).forEach(n=>{
    html+=`
    <div class="card watch">
      <b>NEWS</b><br>
      ${n.headline}<br>
      <small>${n.source}</small><br>
      <a href="${n.url}" target="_blank">ðŸ“° Article</a>
    </div>`;
  });
  document.getElementById("results").innerHTML=html;
}
</script>

</body>
</html>
