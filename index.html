<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner v12 PRO</title>
<style>
body {
  background:#0b1220;
  color:#fff;
  font-family:Arial;
  text-align:center;
}
button,input {
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:16px;
}
.card {
  background:#111a2e;
  margin:15px;
  padding:15px;
  border-radius:12px;
  text-align:left;
}
.hot {border-left:6px solid #00ff88;}
.warm {border-left:6px solid orange;}
.watch {border-left:6px solid #00aaff;}
</style>
</head>
<body>

<h2>ðŸ“ˆ Penny Scanner v12 PRO</h2>

<input id="apikey" placeholder="Enter Finnhub API Key"/>
<button onclick="saveKey()">Save Key</button>
<br><br>

<input id="minvol" type="number" value="100000" />
<button onclick="scan()">Scan Now</button>

<p id="session"></p>
<p id="status"></p>

<div id="results"></div>

<audio id="alertSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
let API_KEY = localStorage.getItem("finnhubKey") || "";
document.getElementById("apikey").value = API_KEY;

function saveKey(){
  API_KEY=document.getElementById("apikey").value;
  localStorage.setItem("finnhubKey",API_KEY);
  alert("Key saved!");
}

function getSession(){
  const now=new Date();
  const et=new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const t=et.getHours()*60+et.getMinutes();
  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "OPEN";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

async function scan(){
  const minVol=parseInt(document.getElementById("minvol").value);
  const session=getSession();
  document.getElementById("session").innerText=`Session: ${session}`;
  document.getElementById("status").innerText="Scanning...";
  document.getElementById("results").innerHTML="";

  if(!API_KEY){
    alert("Enter API key");
    return;
  }

  try{
    const newsRes=await fetch(`https://finnhub.io/api/v1/news?category=general&token=${API_KEY}`);
    const news=await newsRes.json();

    let stocks=[];

    for(let item of news.slice(0,20)){
      const sym=item.related?.split(",")[0];
      if(!sym) continue;

      const q=await fetch(`https://finnhub.io/api/v1/quote?symbol=${sym}&token=${API_KEY}`);
      const data=await q.json();

      if(!data.c || data.c>5 || data.v<minVol) continue;

      let status="WATCH";
      if(data.v>minVol*3) status="HOT";
      else if(data.v>minVol*1.5) status="WARM";

      stocks.push({sym,price:data.c,vol:data.v,headline:item.headline,status});
    }

    stocks.sort((a,b)=>b.vol-a.vol);

    if(stocks.length===0){
      document.getElementById("status").innerText="No penny stocks found";
      return;
    }

    document.getElementById("alertSound").play();
    document.getElementById("status").innerText=`${stocks.length} stocks found`;

    stocks.forEach(s=>{
      const div=document.createElement("div");
      div.className=`card ${s.status.toLowerCase()}`;
      div.innerHTML=`
        <b>${s.sym} $${s.price}</b><br>
        Vol: ${s.vol}<br>
        ${s.headline}<br>
        Status: ${s.status}<br>
        <a target="_blank" href="https://finance.yahoo.com/quote/${s.sym}">ðŸ“Š Chart</a>
      `;
      document.getElementById("results").appendChild(div);
    });

  }catch(err){
    document.getElementById("status").innerText="API error";
    console.log(err);
  }
}

setInterval(scan,60000);
</script>

</body>
</html>
