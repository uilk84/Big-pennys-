<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PennyS Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: radial-gradient(circle at top, #0b1a2b, #02040a);
  color: #e5e7eb;
}
.container {
  padding: 20px;
}
h1 {
  margin-bottom: 20px;
}
.controls {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 15px;
}
button {
  background: #1f2937;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 12px;
  font-size: 14px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #1f2937;
  text-align: left;
}
th {
  opacity: 0.7;
}
tr.alert {
  background: rgba(34,197,94,0.15);
}
.small {
  opacity: 0.6;
  font-size: 12px;
}
</style>
</head>

<body>
<div class="container">
  <h1>PennyS Scanner</h1>

  <div class="controls">
    <button id="soundBtn">ðŸ”” Sound: ON</button>
    <label><input type="checkbox" id="pre"> Premarket</label>
    <label><input type="checkbox" id="post"> Post-Market</label>
  </div>

  <table>
    <thead>
      <tr>
        <th>Sym</th>
        <th>Price</th>
        <th>Vol</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="4" class="small">Waiting for scan...</td></tr>
    </tbody>
  </table>
</div>

<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const API_KEY = "YOUR_POLYGON_KEY";
const rows = document.getElementById("rows");
const beep = document.getElementById("beep");
const soundBtn = document.getElementById("soundBtn");

let soundOn = true;
let seen = {};
let lastVolume = {};

soundBtn.onclick = () => {
  soundOn = !soundOn;
  soundBtn.innerText = soundOn ? "ðŸ”” Sound: ON" : "ðŸ”• Sound: OFF";
};

function inSession() {
  const h = new Date().getHours();
  if (h >= 4 && h < 9.5) return document.getElementById("pre").checked;
  if (h >= 9.5 && h < 16) return true;
  if (h >= 16 && h <= 20) return document.getElementById("post").checked;
  return false;
}

async function scan() {
  if (!inSession()) return;

  try {
    const res = await fetch(
      `https://api.polygon.io/v2/snapshot/locale/us/markets/stocks/tickers?apiKey=${API_KEY}`
    );
    const data = await res.json();

    rows.innerHTML = "";
    let alerted = false;

    data.tickers.forEach(t => {
      const p = t.lastTrade?.p;
      const v = t.day?.v;
      if (!p || !v) return;
      if (p < 0.1 || p > 10) return;
      if (v < 500000) return;

      const prevVol = lastVolume[t.ticker] || 0;
      const isSpike = v > prevVol * 1.3;
      lastVolume[t.ticker] = v;

      if (!seen[t.ticker] || isSpike) {
        seen[t.ticker] = true;

        const tr = document.createElement("tr");
        tr.className = "alert";
        tr.innerHTML = `
          <td>${t.ticker}</td>
          <td>$${p.toFixed(2)}</td>
          <td>${(v/1e6).toFixed(2)}M</td>
          <td>${isSpike ? "VOL SPIKE" : "NEW"}</td>
        `;
        rows.appendChild(tr);
        alerted = true;
      }
    });

    if (!rows.children.length) {
      rows.innerHTML = `<tr><td colspan="4" class="small">No qualified setups</td></tr>`;
    }

    if (alerted && soundOn) beep.play();
  } catch (e) {
    rows.innerHTML = `<tr><td colspan="4" class="small">Feed error (Polygon free tier)</td></tr>`;
  }
}

setInterval(scan, 15000);
</script>
</body>
</html>
