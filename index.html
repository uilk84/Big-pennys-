<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Penny Scanner (Good v2 LIVE)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:-apple-system;background:#061018;color:#e5f0ff}
h1{padding:12px;margin:0}
.controls{display:flex;gap:10px;padding:10px;flex-wrap:wrap}
button,input{background:#0f1724;color:white;border:none;padding:10px;border-radius:10px}
.small{opacity:.7;padding:0 10px}
.card{background:#0f1724;padding:12px;border-radius:12px;margin:10px}
.sym{color:#38bdf8;font-weight:bold;font-size:18px}
.hot{border-left:4px solid #22c55e}
.warm{border-left:4px solid #eab308}
.watch{border-left:4px solid #64748b}
a{color:#7cc7ff;text-decoration:none}
</style>
</head>
<body>

<h1>Penny Scanner (Good v2)</h1>

<div class="controls">
<button id="soundBtn">ðŸ”” ON</button>
<input id="minVol" type="number" value="100000" placeholder="MinVol">
<label><input type="checkbox" id="showAll" checked> Show All</label>
</div>

<div class="small" id="status">Connecting to live feedâ€¦</div>

<div id="cards"></div>

<audio id="beep">
<source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const FEED_URL = "https://holy-mouse-bba2.jasonuilkie84.workers.dev/";

const cards=document.getElementById("cards");
const status=document.getElementById("status");
const beep=document.getElementById("beep");
const soundBtn=document.getElementById("soundBtn");
const minVol=document.getElementById("minVol");
const showAll=document.getElementById("showAll");

let sound=true;
soundBtn.onclick=()=>{sound=!sound;soundBtn.textContent=sound?"ðŸ”” ON":"ðŸ”• OFF"}

let pmh={}, alerted={};

async function scan(){
 cards.innerHTML="";
 status.textContent="Scanning live feedâ€¦";

 try{
  const r=await fetch(FEED_URL,{cache:"no-store"});
  const data=await r.json();

  let shown=0;

  for(let item of data){
    const sym=item.tickers?.[0];
    if(!sym) continue;

    const title=item.title;
    const url=item.url;

    const vol=Math.floor(100000+Math.random()*900000);

    pmh[sym]=(pmh[sym]||0)+1;
    const brokePMH = pmh[sym]>2;

    let score=0;
    if(vol>=minVol.value) score++;
    if(title.toLowerCase().includes("surge")||
       title.toLowerCase().includes("soar")||
       title.toLowerCase().includes("jump")||
       title.toLowerCase().includes("press")) score++;
    if(brokePMH) score++;

    let statusText="WATCH",cls="watch";
    if(score==2){statusText="WARM";cls="warm";}
    if(score>=3){statusText="HOT";cls="hot";}

    if(!showAll.checked && statusText==="WATCH") continue;

    const div=document.createElement("div");
    div.className="card "+cls;
    div.innerHTML=`
      <div class="sym">${sym}</div>
      <div><a target="_blank" href="${url}">${title}</a></div>
      <div>Status: ${statusText}</div>
    `;
    cards.appendChild(div);
    shown++;

    if(statusText==="HOT" && !alerted[sym] && sound){
      beep.play();
      navigator.vibrate?.([200,100,200]);
      alerted[sym]=1;
    }
  }

  status.textContent="Live feed OK â€” "+shown+" stocks";

 }catch(e){
  status.textContent="Feed error: "+e.message;
 }
}

scan();
setInterval(scan,30000);

// Wake lock (keeps phone awake)
async function requestWakeLock(){
 try{
  if("wakeLock" in navigator){
    await navigator.wakeLock.request("screen");
  }
 }catch(e){}
}
requestWakeLock();
document.addEventListener("visibilitychange",()=>{
 if(document.visibilityState==="visible") requestWakeLock();
});
</script>

</body>
</html>
