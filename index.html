<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PennyS Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: radial-gradient(circle at top, #0b1a2b, #02040a);
  color: #e5e7eb;
}
.container { padding: 20px; }
h1 { margin-bottom: 16px; }
.controls {
  display: flex;
  gap: 14px;
  align-items: center;
  margin-bottom: 14px;
}
button {
  background: #1f2937;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 12px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 10px;
  border-bottom: 1px solid #1f2937;
}
th { opacity: 0.7; text-align: left; }
tr.breakout { background: rgba(34,197,94,0.18); }
a {
  color: #93c5fd;
  text-decoration: none;
  font-weight: 600;
}
.small { opacity: 0.6; font-size: 12px; }
</style>
</head>

<body>
<div class="container">
  <h1>PennyS Scanner</h1>

  <div class="controls">
    <button id="soundBtn">ðŸ”” Sound: ON</button>
    <label><input type="checkbox" id="pre" checked> Premarket</label>
    <label><input type="checkbox" id="post"> Post-Market</label>
  </div>

  <table>
    <thead>
      <tr>
        <th>Sym</th>
        <th>Price</th>
        <th>Vol</th>
        <th>Signal</th>
      </tr>
    </thead>
    <tbody id="rows">
      <tr><td colspan="4" class="small">Waiting for scanâ€¦</td></tr>
    </tbody>
  </table>
</div>

<audio id="beep">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const rows = document.getElementById("rows");
const beep = document.getElementById("beep");
const soundBtn = document.getElementById("soundBtn");

let soundOn = true;
let hod = {};
let lastVol = {};
let alerted = {};

soundBtn.onclick = () => {
  soundOn = !soundOn;
  soundBtn.innerText = soundOn ? "ðŸ”” Sound: ON" : "ðŸ”• Sound: OFF";
};

function inSession() {
  const h = new Date().getHours();
  if (h >= 4 && h < 9.5) return document.getElementById("pre").checked;
  if (h >= 9.5 && h < 16) return true;
  if (h >= 16 && h <= 20) return document.getElementById("post").checked;
  return false;
}

async function scan() {
  if (!inSession()) return;

  try {
    const res = await fetch(
      "https://corsproxy.io/?https://query1.finance.yahoo.com/v1/finance/screener/predefined/saved?count=50&scrIds=day_gainers"
    );
    const data = await res.json();
    const list = data.finance.result[0].quotes;

    rows.innerHTML = "";
    let fired = false;

    list.forEach(t => {
      const sym = t.symbol;
      const price = t.regularMarketPrice;
      const vol = t.regularMarketVolume || 0;

      if (!sym || !price) return;
      if (price < 0.1 || price > 10) return;
      if (vol < 500000) return;

      const prevHod = hod[sym] || 0;
      const prevVol = lastVol[sym] || 0;

      hod[sym] = Math.max(prevHod, price);
      lastVol[sym] = vol;

      const isBreakout = price > prevHod && vol > prevVol * 1.25;

      if (isBreakout && !alerted[sym]) {
        alerted[sym] = true;
        fired = true;

        const tr = document.createElement("tr");
        tr.className = "breakout";
        tr.innerHTML = `
          <td>
            <a href="https://www.tradingview.com/chart/?symbol=${sym}"
               target="_blank">${sym}</a>
          </td>
          <td>$${price.toFixed(2)}</td>
          <td>${(vol/1e6).toFixed(2)}M</td>
          <td>BREAKOUT</td>
        `;
        rows.appendChild(tr);
      }
    });

    if (!rows.children.length) {
      rows.innerHTML =
        `<tr><td colspan="4" class="small">No breakout setups</td></tr>`;
    }

    if (fired && soundOn) {
      beep.play().catch(()=>{});
      navigator.vibrate?.([200,100,200]);
    }

  } catch (e) {
    rows.innerHTML =
      `<tr><td colspan="4" class="small">Feed error</td></tr>`;
  }
}

setInterval(scan, 15000);
</script>
</body>
</html>
