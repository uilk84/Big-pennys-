<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Penny Scanner PRO v21</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#020617,#020b2d);
  color: white;
  text-align: center;
  padding: 20px;
}
input, button {
  padding: 10px;
  border-radius: 8px;
  border: none;
  margin: 5px;
}
button {
  background: #3b82f6;
  color: white;
}
.card {
  background:#0f172a;
  padding:15px;
  border-radius:12px;
  margin:12px auto;
  max-width:500px;
  text-align:left;
  box-shadow:0 0 10px rgba(0,0,0,.5);
}
.hot {border-left:6px solid #22c55e;}
.warm {border-left:6px solid #facc15;}
.watch {border-left:6px solid #38bdf8;}
</style>
</head>
<body>

<h1>ðŸ“ˆ Penny Scanner PRO v21</h1>

<input id="apikey" placeholder="Finnhub API key">
<button id="saveKeyBtn">Save Key</button>
<br>

<input id="minvol" type="number" value="100000">
<button id="scanBtn">Scan Now</button>

<br><br>

<label><input type="checkbox" id="prOnly"> PR Only</label>
<label><input type="checkbox" id="topGainers"> Top Gainers</label>
<label><input type="checkbox" id="lightMode"> Light Mode</label>

<h3 id="session">Session: --</h3>

<div id="results"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {

const $ = id => document.getElementById(id);

const API_URL = "https://finnhub.io/api/v1/news?category=general&token=";

$("saveKeyBtn").onclick = () => {
  const key = $("apikey").value.trim();
  if(!key) return alert("Enter API key");
  localStorage.setItem("finnhub_key", key);
  alert("API key saved");
};

$("scanBtn").onclick = runScan;

const saved = localStorage.getItem("finnhub_key");
if(saved) $("apikey").value = saved;

function getSession(){
  const now = new Date();
  const et = new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const t = et.getHours()*60 + et.getMinutes();

  if(t>=240 && t<570) return "PRE-MARKET";
  if(t>=570 && t<960) return "OPEN";
  if(t>=960 && t<1200) return "AFTER-HOURS";
  return "CLOSED";
}

function statusFromText(text){
  if(!text) return "WATCH";
  text=text.toLowerCase();
  if(text.includes("surge")||text.includes("record")||text.includes("beats")) return "HOT";
  if(text.includes("rise")||text.includes("gain")) return "WARM";
  return "WATCH";
}

async function runScan(){
  $("results").innerHTML="Scanning...";
  const key = $("apikey").value.trim();
  if(!key) return alert("Enter API key");

  const session = getSession();
  $("session").innerText = "Session: "+session+" | fetching news...";

  try{
    const res = await fetch(API_URL+key);
    if(!res.ok) throw new Error("API error");
    const data = await res.json();

    let out="";
    data.slice(0,10).forEach(n=>{
      const status = statusFromText(n.headline);
      const cls = status=="HOT"?"hot":status=="WARM"?"warm":"watch";
      out+=`
      <div class="card ${cls}">
        <b>${n.headline}</b><br>
        ${n.summary||""}<br>
        Status: <b>${status}</b><br>
        <a href="${n.url}" target="_blank">ðŸ“Š Article</a>
      </div>`;
    });

    $("results").innerHTML = out || "No news found";
    $("session").innerText = "Session: "+session+" | Live Finnhub";

  }catch(err){
    $("results").innerHTML="<b>API ERROR</b><br>"+err.message;
    $("session").innerText="Session: "+getSession()+" | API failed";
  }
}

});
</script>

</body>
</html>
