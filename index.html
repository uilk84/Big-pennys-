<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Penny Scanner â€“ Good v2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:-apple-system;background:#061018;color:#f1f5f9}
h1{padding:12px;margin:0}
.controls{display:flex;flex-wrap:wrap;gap:10px;padding:10px}
button,input,label{background:#0f1724;color:white;border:none;border-radius:10px;padding:8px 10px}
.small{opacity:.7;padding:0 12px;font-size:13px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left}
.hot{background:rgba(34,197,94,.25)}
.warm{background:rgba(234,179,8,.2)}
.watch{opacity:.6}
.news a{color:#7cc7ff;font-weight:600;text-decoration:none}
#cards{display:none;padding:10px}
.card{background:#0f1724;border-radius:12px;padding:12px;margin-bottom:10px}
.sym{font-weight:800;color:#38bdf8;font-size:18px}
.leader{background:#1f2937;padding:8px;border-radius:8px;margin:10px}
@media(max-width:800px){
 table{display:none}
 #cards{display:block}
}
</style>
</head>
<body>

<h1>Penny Scanner (Good v2)</h1>

<div class="controls">
<button id="soundBtn">ðŸ”” ON</button>
<label>MinVol <input id="minVol" type="number" value="100000" style="width:100px"></label>
<label><input type="checkbox" id="showAll" checked> Show All</label>
</div>

<div class="small">
Feed: Finviz News Movers | Next scan in <span id="timer">30</span>s
</div>

<div id="leader" class="leader"></div>

<table>
<thead>
<tr><th>Symbol</th><th>Vol</th><th>News</th><th>Status</th></tr>
</thead>
<tbody id="rows">
<tr><td colspan="4">Loadingâ€¦</td></tr>
</tbody>
</table>

<div id="cards"></div>

<audio id="beep">
<source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
</audio>

<script>
const rows=document.getElementById("rows");
const cards=document.getElementById("cards");
const leaderDiv=document.getElementById("leader");
const beep=document.getElementById("beep");
const soundBtn=document.getElementById("soundBtn");
const timerEl=document.getElementById("timer");

let sound=true;
soundBtn.onclick=()=>{sound=!sound;soundBtn.textContent=sound?"ðŸ”” ON":"ðŸ”• OFF"};

let pmh={};
let alerted={};

let timer=30;
setInterval(()=>{
 timer--;
 if(timer<=0) timer=30;
 timerEl.textContent=timer;
},1000);

async function scan(){
 rows.innerHTML="";
 cards.innerHTML="";
 leaderDiv.innerHTML="";

 try{
  const url="https://corsproxy.io/?https://finviz.com/api/news.ashx";
  const r=await fetch(url);
  const data=await r.json();

  let leaders=[];
  let minVol=+document.getElementById("minVol").value||100000;
  let showAll=document.getElementById("showAll").checked;

  for(let i=0;i<20;i++){
    const item=data[i];
    const sym=item.tickers[0];
    const title=item.title;
    const vol=Math.floor(Math.random()*2000000)+50000; // simulated volume (Finviz API doesn't provide vol)

    // PMH logic (simulated with news count)
    pmh[sym]=(pmh[sym]||0)+1;
    const brokePMH=pmh[sym]>2;

    let score=0;
    if(vol>minVol) score++;
    if(title.toLowerCase().includes("surge")||title.toLowerCase().includes("soars")) score++;
    if(brokePMH) score++;

    let status="WATCH",cls="watch";
    if(score==2){status="WARM";cls="warm";}
    if(score>=3){status="HOT";cls="hot";leaders.push(sym);}

    if(!showAll && status==="WATCH") continue;

    rows.innerHTML+=`
      <tr class="${cls}">
        <td>${sym}</td>
        <td>${(vol/1e6).toFixed(2)}M</td>
        <td class="news"><a target=_blank href="${item.url}">${title}</a></td>
        <td>${status}</td>
      </tr>
    `;

    cards.innerHTML+=`
      <div class="card ${cls}">
        <div class="sym">${sym}</div>
        <div class="news"><a target=_blank href="${item.url}">${title}</a></div>
        <div>Status: ${status}</div>
      </div>
    `;

    if(status==="HOT" && !alerted[sym] && sound){
      beep.play();
      navigator.vibrate?.([200,100,200]);
      alerted[sym]=true;
    }
  }

  if(leaders.length){
    leaderDiv.innerHTML="<strong>Leaders:</strong> "+leaders.slice(0,3).join(" â€¢ ");
  }

  if(!rows.children.length){
    rows.innerHTML="<tr><td colspan=4>No results</td></tr>";
  }

 }catch(e){
  rows.innerHTML="<tr><td colspan=4>Feed error</td></tr>";
 }
}

scan();
setInterval(scan,30000);
</script>
</body>
</html>
